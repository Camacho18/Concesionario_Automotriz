
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!--[I] Mantenimiento-->
<br />
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title text-center">Mantenimientos</h5>
            </div>
            <div class="card-body">
                <div class="">
                    <button class="btn btn-primary col-2" id="Btn_NewMant">Nuevo +</button>
                </div>
                <br />
                <div class="">
                    @Html.EJS().Grid("Grid_Mantenimiento").RowSelected("RowClearSelect").RowDeselected("RowClearSelect").AllowResizing(true).AllowSorting().AllowFiltering().Columns(col =>
               {
                   col.Field("IdMantenimiento").HeaderText("Mantenimiento").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Center).Visible(false).Add();
                   col.Field("Fecha").HeaderText("Fecha de ingreso").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Center).Type("date").Format("yMd").Add();
                   col.Field("Usuario").HeaderText("Empleado").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Center).Add();
                   col.Field("Automovil").HeaderText("Automovil-Modelo").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Center).Add();
                   col.Field("Estado").HeaderText("Estado").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Center).Add();
                   col.HeaderText("Opciones").Template("#templateMant").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Center).Add();
               }).AllowPaging().SelectionSettings(select => select.Type(Syncfusion.EJ2.Grids.SelectionType.Single)).PageSettings(page => page.PageCount(5)).Render()

                </div>
            </div>
        </div>
    </div>
</div>
<style>
    .e-grid .e-headercell {
        background-color: #eeeeee;
    }

    .e-grid .e-gridheader {
        color: black;
    }
</style>

<script id="templateMant" type="text/x-template">
    <div class="row text-center">
        <div class="col-md-12 ">
            <div class="">
                <a class="text-succcess" href="javascript:void(0)" onclick="RowSelectMant(${IdMantenimiento})" data-toggle="tooltip" data-placement="top" title="Ver refacciones">
                    <i class="fa fa-edit"></i>
                </a>
                ${if(Estado=="En reparación")}
                <a class="text-danger" style="padding:0px,5px,0px,5px; margin-left:10px; margin-right:10px" href="javascript:void(0)" onclick="CancelarMant(${IdMantenimiento})" data-toggle="tooltip" data-placement="top" title="Cancelar">
                    <i class="fa fa-remove"></i>
                </a>
                ${else}
                <a class="text-danger" style="padding:0px,5px,0px,5px; margin-left:10px; margin-right:10px" href="javascript:void(0)" onclick="Denegado()" data-toggle="tooltip" data-placement="top" title="Cancelar">
                    <i class="fa fa-remove"></i>
                </a>
                ${/if}
            </div>
        </div>
    </div>
</script>
<!--[F] Mantenimiento-->
<!--[I] Mantenimiento Autopartes-->

<br />
<div id="viewMante" class="row" hidden>
    <div class="col-12">
        <div class="card">
            <div class="card-body">

                <div class="row col-12">
                    <h5 class="col-12 text-center">Autopartes de mantenimiento</h5>
                </div>
                <br />
                <div class="row col-12">
                    <button class="btn btn-primary col-2" id="Btn_NewManteAuto">Nuevo +</button>
                    <div class="col-8 text-center"><h6 id="num"></h6></div>
                    <div class="col-2"></div>
                </div>
                <br />
                <div class="">
                    @Html.EJS().Grid("Grid_ManteAuto").AllowResizing(true).AllowSorting().AllowFiltering().Columns(col =>
               {
                   col.Field("IdManten_Autopar").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Center).Visible(false).Add();
                   col.Field("Precio").HeaderText("Precio").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Center).Add();
                   col.Field("Autoparte").HeaderText("Autoparte").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Center).Add();
                   col.Field("Cantidad_Autopartes").HeaderText("Cantidad de autopartes").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Center).Add();
                   col.HeaderText("Opciones").Template("#templateMante").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Center).Add();
               }).AllowPaging().SelectionSettings(select => select.Type(Syncfusion.EJ2.Grids.SelectionType.Single)).PageSettings(page => page.PageCount(4).PageSize(4)).Render()
                </div>
            </div>
        </div>
    </div>
</div>
<script id="templateMante" type="text/x-template">
    <div class="row text-center">
        <div class="col-md-12 ">
            <div class="">
                ${if(Estado=="En reparación")}
                <a class="text-succcess" href="javascript:void(0)" onclick="UpdateManteAuto(${IdMante_Autopar})" data-toggle="tooltip" data-placement="top" title="Editar">
                    <i class="fa fa-edit"></i>
                </a>
                <a class="text-danger" style="padding:0px,5px,0px,5px; margin-left:10px; margin-right:10px" href="javascript:void(0)" onclick="DeleteManteAuto(${ IdMante_Autopar })" data-toggle="tooltip" data-placement="top" title="Eliminar">
                    <i class="fa fa-remove"></i>
                </a>
                ${/if}
            </div>
        </div>
    </div>
</script>
<!--[F] Mantenimiento Autopartes-->

<!--[I] Modal-->
<div class="modal fade" id="CreateMantModal">
    <div class="modal-dialog  modal-lg">
        <div class="modal-content">
            <div id="frmMant">

            </div>

        </div>
    </div>
</div>

<script>
    $(function () { MantenimientoLoad();  })
//Función de mantenimiento
    function MantenimientoLoad() {

        $.get('@Url.Action("MantenimientoJson","Mantenimiento")', function (data) {
            var grid = document.getElementById('Grid_Mantenimiento').ej2_instances[0]; // Grid instance
            grid.dataSource = JSON.parse(data);
        });
    }

    $('#Btn_NewMant').click(function () {
        $.get('@Url.Action("CreateMantenimiento","Mantenimiento")', function (data) {
            $('#frmMant').html(data);
            $('#CreateMantModal').modal("show");
        });
    });

    function RowSelectMant(IdMantenimiento) {
        $.get('@Url.Action("ManteAutoJson","Mantenimiento", new { Id = "_id_" })'.replace('_id_', IdMantenimiento), function (data) {
            $("#viewMante").removeAttr("hidden");
            var grid = document.getElementById('Grid_ManteAuto').ej2_instances[0]; // Grid instance
            grid.dataSource = JSON.parse(data.JsonString);
            var text = "Modelo del automovil" + " ";
            $('#num').text(text);
        });
    }
    function DeleteMant(IdMantenimiento) {
            Swal.fire({
                position: "top",
                title: 'Eliminar',
                text: "Desea Cancelar el mantenimiento!",
                icon: 'warning',
                showCancelButton: true,
                showConfirmButton: true,
                cancelButtonColor: '#d33',
                confirmButtonColor: '#3085d6',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Eliminar',
                reverseButtons: true
            }).then((result) => {
                if (result.value) {
                    $.get('@Url.Action("DeleteMant","Mantenimiento", new { IdMantenimiento = "_id_"})'.replace('_id_', IdMantenimiento), function (data) {
                        MantenimientoLoad();
                        Swal.fire({
                            position: "top",
                            title: "Correcto",
                            text: "Mantenimiento Cancelado",
                            icon: "success",
                            button: "Aceptar",
                        });
                    });
                }
            })
    };
    function Denegado() {
        Swal.fire({
            position: "top",
            title: "Error",
            text: "El mantenimiento no se puede cancelar",
            icon: "warning",
            button: "Aceptar",
        }); 
        @*Swal.fire({
                position: "top",
                title: 'Eliminar',
                text: "Desea Cancelar el mantenimiento!",
                icon: 'warning',
                showCancelButton: true,
                showConfirmButton: true,
                cancelButtonColor: '#d33',
                confirmButtonColor: '#3085d6',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Eliminar',
                reverseButtons: true
            }).then((result) => {
                if (result.value) {
                    $.get('@Url.Action("DenegadoMant","Mantenimiento", new { IdMantenimiento = "_id_"})'.replace('_id_', IdMantenimiento), function (data) {
                        MantenimientoLoad();
                        Swal.fire({
                            position: "top",
                            title: "Error",
                            text: "El mantenimiento no se puede cancelar",
                            icon: "warning",
                            button: "Aceptar",
                        });           
                    });
                }
            })*@
        }
    //[F] Mantenimiento

    //[I] Mantenimiento Autoparte
    function ManteAutoLoad() {

            $.get('@Url.Action("ManteAutoJson","Mantenimiento")', function (data) {
                $("#viewMante").removeAttr("hidden");
                var grid = document.getElementById('Grid_ManteAuto').ej2_instances[0]; // Grid instance
                grid.dataSource = JSON.parse(data.JsonString);
                var text = "Número de Accesorio:" + " ";
                $('#num').text(text);
            });
    }

    function RowClearSelect() { $("#viewMante").attr("hidden", true); }

    $('#Btn_NewManteAuto').click(function () {
        $.get('@Url.Action("CreateManteAuto","Mantenimiento")', function (data) {
            $('#frmMant').html(data);
            $('#CreateMantModal').modal("show");
        });
    });

    function UpdateManteAuto(Id) {
            $.get('@Url.Action("UpdateManteAuto", "Mantenimiento", new { Id = "_id_" })'.replace('_id_', Id), function (data) {
                $('#frmMante').html(data);
                $('#CreateMantModal').modal("show");
            });
    }
    function DeleteManteAuto(IdMante_Autopar) {
            Swal.fire({
                position: "top",
                title: 'Eliminar',
                text: "Desea eliminar el autoparte del mantenimiento!",
                icon: 'warning',
                showCancelButton: true,
                showConfirmButton: true,
                cancelButtonColor: '#d33',
                confirmButtonColor: '#3085d6',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Eliminar',
                reverseButtons: true
            }).then((result) => {
                if (result.value) {
                    $.get('@Url.Action("DeleteManteAuto","Mantenimiento", new { IdMante_Autopar = "_id_"})'.replace('_id_', IdMante_Autopar), function (data) {
                        MantenimientoLoad();
                        Swal.fire({
                            position: "top",
                            title: "Correcto",
                            text: "Autoparte Eliminado",
                            icon: "success",
                            button: "Aceptar",
                        });
                    });
                }
            })
    };

    // Fin de Mantenimiento Autopartes
    

    
</script>